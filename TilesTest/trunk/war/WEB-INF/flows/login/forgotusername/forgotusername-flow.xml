<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">


    <var name="webSecurityModel" class="com.arag.client.registration.WebSecurityModel" />

	<view-state id="enterRegistrationId" view="login/forgotusername" model="webSecurityModel" >
		<binder>
			<binding property="registrationId" required="true"/>
		</binder>
		<transition on="continue" to="answerSecurityQuestion" />
	</view-state>
	

	<view-state id="answerSecurityQuestion" view="login/forgotusernamesecurity" model="webSecurityModel">
		<binder>
			<binding property="answerText" required="true"/>
		</binder>
		<on-entry>
			<evaluate expression="webSecurityFlowAction.fillRandomQAndA(webSecurityModel, flowRequestContext)" />
		</on-entry>
		<transition on="continue" to="enterPassword" />
	</view-state>

	<view-state id="enterPassword" view="login/forgotusernameconfirmation" model="webSecurityModel">
		<binder>
			<binding property="password" required="true" />
		</binder>
		<transition on="continue" to="loginUser" />
		<transition on="forgotPassword" to="forgotPassword" />
	</view-state>
	
	<end-state id="cancel" view="externalRedirect:contextRelative:/login/index.htm" />
	<end-state id="accountLocked" view="externalRedirect:contextRelative:/login/accountlocked.htm" />
	<end-state id="loginUser" view="externalRedirect:contextRelative:/j_spring_security_check?j_username=${webSecurityModel.username}&amp;j_password=${webSecurityModel.password}" />
	<end-state id="forgotPassword" view="externalRedirect:contextRelative:/login/forgotpassword.htm"/>
	
	<global-transitions>
		<transition on-exception="com.arag.common.exception.AccountLockedException" to="accountLocked" history="invalidate"/>
		<transition on="cancel" to="cancel" history="invalidate" bind="false" />
	</global-transitions>
		
</flow>